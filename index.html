<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DACN - Step 1</title>
    <style>
        :root { --p: #000; --s: #10b981; --g: #94a3b8; }
        body { font-family: 'Inter', sans-serif; background: #fff; margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; }
        .card { width: 100%; max-width: 350px; text-align: center; padding: 20px; }
        .status { display: inline-flex; align-items: center; gap: 8px; padding: 8px 16px; background: #f1f5f9; border-radius: 100px; font-size: 12px; font-weight: bold; color: var(--g); margin-bottom: 20px; }
        .status.ok { background: #dcfce7; color: var(--s); }
        .spinner { width: 14px; height: 14px; border: 2px solid #cbd5e1; border-top: 2px solid var(--p); border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        select { width: 100%; padding: 15px; border-radius: 12px; border: 2px solid #f1f5f9; font-size: 16px; margin-bottom: 20px; outline: none; pointer-events: none; opacity: 0.6; }
        select.active { pointer-events: auto; opacity: 1; border-color: #e2e8f0; }
        .btn { width: 100%; padding: 16px; border-radius: 12px; border: none; background: #e2e8f0; color: var(--g); font-weight: bold; cursor: not-allowed; transition: 0.3s; }
        .btn.active { background: var(--p); color: #fff; cursor: pointer; }
    </style>
</head>
<body>
    <script>
        // অটো-রিডাইরেক্ট চেক
        if (localStorage.getItem('setup_complete') === 'true') {
            window.location.href = "dashboard.html";
        }
    </script>
    <div class="card">
        <div id="badge" class="status"><div id="loader" class="spinner"></div><span id="text">Verifying Location...</span></div>
        <h2>Node Identity</h2>
        <p style="color: #64748b; font-size: 14px;">আপনার বর্তমান লোকেশন শনাক্ত করা হচ্ছে...</p>
        <select id="country" class="select-field"><option value="">Detecting...</option><option value="Bangladesh">Bangladesh</option></select>
        <button id="btn" class="btn" onclick="goNext()" disabled>Continue</button>
    </div>
    <script>
        const sel = document.getElementById('country');
        const btn = document.getElementById('btn');
        const badge = document.getElementById('badge');
        window.onload = function() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(pos => {
                    fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${pos.coords.latitude}&longitude=${pos.coords.longitude}&localityLanguage=en`)
                    .then(r => r.json()).then(data => {
                        localStorage.setItem('user_country', data.countryName);
                        localStorage.setItem('step1_ok', 'true');
                        sel.innerHTML = `<option value="${data.countryName}">${data.countryName}</option>`;
                        sel.classList.add('active');
                        btn.classList.add('active'); btn.disabled = false;
                        badge.classList.add('ok'); document.getElementById('loader').style.display='none';
                        document.getElementById('text').innerText = '✓ Location Verified';
                    });
                }, () => { alert("Please enable GPS"); });
            }
        };
        function goNext() { window.location.href = "next.html"; }
    </script>
</body>
</html>
