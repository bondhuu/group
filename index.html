<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Minimal P2P Connect Demo</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  input, button { padding: 5px; margin: 5px 0; }
  #connect-section, #username-section, #network-page { margin-top: 20px; }
  #network-page { display: none; }
</style>
</head>
<body>

<h2>Minimal P2P Connect Demo</h2>

<div id="id-section">
  <p>Your Browser ID: <span id="my-id"></span></p>
</div>

<div id="connect-section">
  <p>Paste other Browser ID to connect:</p>
  <input type="text" id="peer-id" placeholder="Other Browser ID">
  <button id="connect-btn">Connect</button>
  <p id="connect-status"></p>
</div>

<div id="username-section">
  <p>Enter your Username:</p>
  <input type="text" id="username" placeholder="Your username">
  <button id="username-btn">Submit</button>
</div>

<div id="network-page">
  <h3>Connected Devices: <span id="connected-count">0</span></h3>
  <p>Welcome, <span id="display-username"></span>!</p>
  <p>Network is ready.</p>
</div>

<script>
// Generate a random unique ID for this browser session
let myID = localStorage.getItem('myID');
if (!myID) {
  myID = 'ID-' + Math.random().toString(36).substr(2, 9);
  localStorage.setItem('myID', myID);
}
document.getElementById('my-id').textContent = myID;

// Load username if previously saved
let savedUsername = localStorage.getItem('username');

// Minimal peer list (simulate network)
let peers = [];
if (savedUsername) {
  document.getElementById('username-section').style.display = 'none';
  showNetworkPage();
}

// Connect button
document.getElementById('connect-btn').onclick = function() {
  const peerID = document.getElementById('peer-id').value.trim();
  if (peerID && !peers.includes(peerID) && peerID !== myID) {
    peers.push(peerID);
    document.getElementById('connect-status').textContent = 'Connected to ' + peerID;
    updateConnectedCount();
    checkReady();
  } else {
    alert('Invalid or duplicate ID');
  }
};

// Username submit
document.getElementById('username-btn').onclick = function() {
  const username = document.getElementById('username').value.trim();
  if (username) {
    localStorage.setItem('username', username);
    showNetworkPage();
  } else {
    alert('Enter a valid username');
  }
};

function updateConnectedCount() {
  document.getElementById('connected-count').textContent = peers.length + 1; // include self
}

function checkReady() {
  if (peers.length >= 1 && localStorage.getItem('username')) {
    showNetworkPage();
  }
}

function showNetworkPage() {
  document.getElementById('username-section').style.display = 'none';
  document.getElementById('connect-section').style.display = 'none';
  document.getElementById('network-page').style.display = 'block';
  document.getElementById('display-username').textContent = localStorage.getItem('username');
  updateConnectedCount();
}
</script>

</body>
</html>
